
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A lightweight function-oriented toolkit for better organisation of business logic and efficient selection and projection of data in Django projects.">
      
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.3.9">
    
    
      
        <title>Explanation - django-readers</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#e92063">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="pink" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#motivation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="django-readers" class="md-header__button md-logo" aria-label="django-readers" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.5 14.33c.79 0 1.63.08 2.5.24v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.33-4.5.99v-1.69c1.17-.53 2.67-.8 4.5-.8M13 12.46c1.29-.53 2.79-.79 4.5-.79.79 0 1.63.07 2.5.23v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.34-4.5.99m4.5-3.65c-1.9 0-3.39.32-4.5 1V9.84c1.23-.56 2.73-.84 4.5-.84.79 0 1.63.08 2.5.23v1.55c-.74-.19-1.59-.28-2.5-.28m3.5 8V7c-1.04-.33-2.21-.5-3.5-.5-2.05 0-3.88.5-5.5 1.5v11.5c1.62-1 3.45-1.5 5.5-1.5 1.19 0 2.36.16 3.5.5m-3.5-14c2.35 0 4.19.5 5.5 1.5v14.56c0 .12-.05.24-.16.35-.11.09-.23.17-.34.17-.11 0-.19-.02-.25-.05-1.28-.69-2.87-1.03-4.75-1.03-2.05 0-3.88.5-5.5 1.5-1.34-1-3.17-1.5-5.5-1.5-1.66 0-3.25.36-4.75 1.07-.03.01-.07.01-.12.03-.04.01-.08.02-.13.02-.11 0-.23-.04-.34-.12a.475.475 0 0 1-.16-.35V6c1.34-1 3.18-1.5 5.5-1.5 2.33 0 4.16.5 5.5 1.5 1.34-1 3.17-1.5 5.5-1.5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            django-readers
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Explanation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dabapps/django-readers/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    dabapps/django-readers
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="django-readers" class="md-nav__button md-logo" aria-label="django-readers" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.5 14.33c.79 0 1.63.08 2.5.24v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.33-4.5.99v-1.69c1.17-.53 2.67-.8 4.5-.8M13 12.46c1.29-.53 2.79-.79 4.5-.79.79 0 1.63.07 2.5.23v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.34-4.5.99m4.5-3.65c-1.9 0-3.39.32-4.5 1V9.84c1.23-.56 2.73-.84 4.5-.84.79 0 1.63.08 2.5.23v1.55c-.74-.19-1.59-.28-2.5-.28m3.5 8V7c-1.04-.33-2.21-.5-3.5-.5-2.05 0-3.88.5-5.5 1.5v11.5c1.62-1 3.45-1.5 5.5-1.5 1.19 0 2.36.16 3.5.5m-3.5-14c2.35 0 4.19.5 5.5 1.5v14.56c0 .12-.05.24-.16.35-.11.09-.23.17-.34.17-.11 0-.19-.02-.25-.05-1.28-.69-2.87-1.03-4.75-1.03-2.05 0-3.88.5-5.5 1.5-1.34-1-3.17-1.5-5.5-1.5-1.66 0-3.25.36-4.75 1.07-.03.01-.07.01-.12.03-.04.01-.08.02-.13.02-.11 0-.23-.04-.34-.12a.475.475 0 0 1-.16-.35V6c1.34-1 3.18-1.5 5.5-1.5 2.33 0 4.16.5 5.5 1.5 1.34-1 3.17-1.5 5.5-1.5Z"/></svg>

    </a>
    django-readers
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dabapps/django-readers/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    dabapps/django-readers
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cookbook/" class="md-nav__link">
        Cookbook
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Explanation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Explanation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features-and-concepts" class="md-nav__link">
    Features and concepts
  </a>
  
    <nav class="md-nav" aria-label="Features and concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queryset-preparation-functions" class="md-nav__link">
    Queryset preparation functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#producers-and-projectors" class="md-nav__link">
    Producers and projectors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pairs" class="md-nav__link">
    Pairs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specs" class="md-nav__link">
    Specs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where-should-this-code-go" class="md-nav__link">
    Where should this code go?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-about-other-types-of-business-logic" class="md-nav__link">
    What about other types of business logic?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-django-readers-a-service-layer" class="md-nav__link">
    Is django-readers a "service layer"?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-django-readers-a-serialization-or-data-conversion-library" class="md-nav__link">
    Is django-readers a serialization or data conversion library?
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/queryset-functions/" class="md-nav__link">
        Queryset functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/producers/" class="md-nav__link">
        Producers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/projectors/" class="md-nav__link">
        Projectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/pairs/" class="md-nav__link">
        Pairs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/specs/" class="md-nav__link">
        Specs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/rest-framework/" class="md-nav__link">
        REST framework
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Community
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Community" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../community/third-party-packages/" class="md-nav__link">
        Third Party Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../community/changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../community/license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features-and-concepts" class="md-nav__link">
    Features and concepts
  </a>
  
    <nav class="md-nav" aria-label="Features and concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queryset-preparation-functions" class="md-nav__link">
    Queryset preparation functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#producers-and-projectors" class="md-nav__link">
    Producers and projectors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pairs" class="md-nav__link">
    Pairs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specs" class="md-nav__link">
    Specs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where-should-this-code-go" class="md-nav__link">
    Where should this code go?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-about-other-types-of-business-logic" class="md-nav__link">
    What about other types of business logic?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-django-readers-a-service-layer" class="md-nav__link">
    Is django-readers a "service layer"?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-django-readers-a-serialization-or-data-conversion-library" class="md-nav__link">
    Is django-readers a serialization or data conversion library?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Explanation</h1>

<p><code>django-readers</code> provides a set of tools to help with the parts of your business logic that are responsible for <em>reads</em> from the database: selecting and transforming data before presenting it to clients. It can be used with views that render Django templates as well as Django REST framework views.</p>
<p>The functionality that <code>django-readers</code> provides is deliberately straightforward and interoperable with existing Django libraries, patterns and practices. You can choose to use just the parts of <code>django-readers</code> that appeal to you and make sense in your project.</p>
<p>A <code>django-readers</code> "spec" precisely specifies the data that your view depends on (which particular fields from which related models). <em>Only</em> this data will be fetched from the database, in the most efficient way possible. This is intended to avoid the <a href="https://stackoverflow.com/questions/97197/what-is-the-n1-selects-problem-in-orm-object-relational-mapping">N+1 queries problem</a> and can dramatically improve the performance of your application.</p>
<p>However, <code>django-readers</code> is more than just this. It is also intended to suggest patterns which help with organising business logic in a Django codebase, following a function-oriented style. It introduces a few simple concepts, and provides some tools to assemble them together into a working application. It can easily be combined with existing patterns and libraries.</p>
<ul>
<li><strong>queryset preparation functions</strong> replace custom queryset methods and encapsulate data selection: filtering, annotation etc. They can be composed to express complex selection logic.</li>
<li><strong>producer and projector functions</strong> replace model methods and encapsulate business logic for transforming and presenting data. They can be combined to form lightweight business objects (dictionaries) that are the right shape for the code that consumes them.</li>
<li><strong>reader pairs</strong> combine queryset functions and producers (or projectors), expressing the dependencies between them.</li>
<li>a high-level <strong>spec</strong> provides a concise way to express exactly which data should be selected and projected at the point of use.</li>
</ul>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>Django common practices encourage a "fat models" approach. Most of the business logic of the application goes in the model layer (on the models themselves, or on custom managers or querysets). Experience has suggested that this is often a bad idea for several reasons:</p>
<p>First, it goes against the <a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">Single Responsibility Principle</a>. Models are already responsible for mapping between your database tables and your application code and back again. This mapping is a highly complex task, and that's quite enough for one set of classes to be responsible for.</p>
<p>Second, it is bad for code organisation, particularly in larger projects. Your <code>models.py</code> becomes a trash pile onto which all business logic is dumped. Models and querysets grow to thousands of lines of code. The API surface area for each model becomes huge, and this entire surface is available to any part of your application that imports the model.</p>
<p>Third and worst, often model methods themselves perform queries against other models. This is a disaster for application performance, leading to inefficient query patterns that can be very difficult to fix. When they <em>are</em> fixed (through judicious use of <code>select_related</code> and <code>prefetch_related</code> on the queryset), the model methods become tightly coupled to the precise way that the query is built, resulting in unpredictable and brittle code.</p>
<p><code>django-readers</code> encourages you to structure your code around plain functions rather than methods on classes. You can put these functions wherever you like in your codebase. Complex business logic is built by composing and combining these functions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAGNI, "You Aren't Gonna Need It", it's a <a href="https://martinfowler.com/bliki/Yagni.html">well-understood mantra</a> in software development. It means that you should only make changes to your software (including adding abstraction and generalising code structures) when you are sure that you absolutely need them, and not before. Related to this is the famous quote from Donald Knuth: "premature optimization is the root of all evil". This suggests that usually performance concerns fall under YAGNI: you shouldn't spend time making code fast until its slowness becomes a real problem for users.</p>
<p>As a counterpoint to this advice, Simon Willison coined the phrase <a href="https://simonwillison.net/2021/Jul/1/pagnis/">PAGNI</a>, "Probably Are Gonna Need It". PAGNI applies in situations "when the cost of adding something later is so dramatically expensive compared with the cost of adding it early on that it’s worth taking the risk [...] when you know from experience that an initial investment will pay off many times over."</p>
<p><code>django-readers</code> (and its sister project <a href="https://github.com/dabapps/django-zen-queries"><code>django-zen-queries</code></a>) were built partly as a result of a strong belief (gained through many years of experience) that understanding and controlling your application's database querying behaviour firmly falls into the PAGNI category. This is particularly true of applications that you know are going to be complex: any code abstraction patterns you decide to follow in order to manage the complexity <em>must</em> take into account query patterns or they are highly likely to cause terrible performance problems. This is the heart of the <a href="https://en.wikipedia.org/wiki/Object%E2%80%93relational_impedance_mismatch">object-relational impedance mismatch</a>.</p>
</div>
<h2 id="features-and-concepts">Features and concepts<a class="headerlink" href="#features-and-concepts" title="Permanent link">&para;</a></h2>
<p><code>django-readers</code> is organised in three layers of <em>"reader functions"</em>. At the highest level of abstraction is <code>django_readers.specs</code> (the top layer), which depends on <code>django_readers.pairs</code> (the middle layer), which depends on <code>django_readers.producers</code>, <code>django_readers.projectors</code> and <code>django_readers.qs</code> (the bottom layer).</p>
<p>These layers can be intermingled in a real-world application. To expain each layer, it makes most sense to start at the bottom and work upwards.</p>
<h3 id="queryset-preparation-functions">Queryset preparation functions<a class="headerlink" href="#queryset-preparation-functions" title="Permanent link">&para;</a></h3>
<p>A queryset preparation function is a function that accepts a queryset as its single argument, and returns a new queryset with some modifications applied. These functions are used to encapsulate database query logic that would traditionally live in a custom queryset method. If you were writing one of these yourself, it might look like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p">(</span><span class="n">queryset</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;shakespeare&quot;</span><span class="p">)</span>
</code></pre></div>
<p>However, you don't usually need to write your own queryset functions: <code>django-readers</code> provides a <a href="../reference/queryset-functions/">library of functions under <code>django_readers.qs</code></a> which mirror all the default methods on the base <code>QuerySet</code> that return a new queryset, as well as some extra utility functions.</p>
<p>Queryset functions can be combined with the <a href="../reference/queryset-functions/#pipe"><code>qs.pipe</code></a> function (named following standard functional programming parlance). <code>qs.pipe</code> returns a new queryset function that calls each function in its argument list in turn, passing the return value of the first as the argument of the second, and so on. It literally "pipes" your queryset through its list of functions.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django_readers</span><span class="w"> </span><span class="kn">import</span> <span class="n">qs</span>

<span class="n">recent_books_with_prefetched_authors</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
    <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">publication_date__year</span><span class="o">=</span><span class="mi">2020</span><span class="p">),</span>
    <span class="n">qs</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s2">&quot;authors&quot;</span><span class="p">),</span>
    <span class="n">qs</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">queryset</span> <span class="o">=</span> <span class="n">recent_books_with_prefetched_authors</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</code></pre></div>
<h3 id="producers-and-projectors">Producers and projectors<a class="headerlink" href="#producers-and-projectors" title="Permanent link">&para;</a></h3>
<p>A <a href="../reference/producers/">producer</a> is a function that accepts a model instance as its single argument, and returns a value representing a subset or transformation of the instance data.</p>
<p>Business logic that would traditionally go in model methods should instead go in producers.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>


<span class="k">def</span><span class="w"> </span><span class="nf">produce_age</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="n">instance</span><span class="o">.</span><span class="n">birth_year</span>


<span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Some Author&quot;</span><span class="p">,</span> <span class="n">birth_year</span><span class="o">=</span><span class="mi">1984</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">produce_age</span><span class="p">(</span><span class="n">author</span><span class="p">))</span>
<span class="c1">#  37</span>
</code></pre></div>
<p>The simplest producer is one that returns the value of an object attribute. <code>django-readers</code> provides a function to create producers that do this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django_readers</span><span class="w"> </span><span class="kn">import</span> <span class="n">producers</span>

<span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Some Author&quot;</span><span class="p">)</span>
<span class="n">produce_name</span> <span class="o">=</span> <span class="n">producers</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">produce_name</span><span class="p">(</span><span class="n">author</span><span class="p">))</span>
<span class="c1">#  &#39;Some Author&#39;</span>
</code></pre></div>
<p>Producers return a value, but in order to convert a model instance into a lightweight business object (a dictionary) suitable for passing around your project, this value must be combined with a name. This is the role of a <a href="../reference/projectors/">projector</a>. A projector function takes a model instance and returns a dictionary mapping keys to the values returned by producer functions.</p>
<p>These functions "project" your data layer into your application's business logic domain. Think of the dictionary returned by a projector (the "projection") as the simplest possible domain object. Generally speaking, it's not necessary to write your own projector functions. You can instead wrap a producer function with <a href="../reference/projectors/#producer_to_projector"><code>projectors.producer_to_projector</code></a></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_readers</span><span class="w"> </span><span class="kn">import</span> <span class="n">projectors</span>


<span class="k">def</span><span class="w"> </span><span class="nf">produce_age</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="n">instance</span><span class="o">.</span><span class="n">birth_year</span>


<span class="n">project_age</span> <span class="o">=</span> <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">produce_age</span><span class="p">)</span>

<span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Some Author&quot;</span><span class="p">,</span> <span class="n">birth_year</span><span class="o">=</span><span class="mi">1984</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">project_age</span><span class="p">(</span><span class="n">author</span><span class="p">))</span>
<span class="c1">#  {&#39;age&#39;: 37}</span>
</code></pre></div>
<p>Like queryset functions, projectors are intended to be <em>composable</em>: multiple simple projector functions can be combined into a more complex projector function that returns a dictionary containing the keys and values from all of its child projectors. This is done using the <a href="../reference/projectors/#combine"><code>projectors.combine</code></a> function:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django_readers</span><span class="w"> </span><span class="kn">import</span> <span class="n">producers</span><span class="p">,</span> <span class="n">projectors</span>

<span class="n">project</span> <span class="o">=</span> <span class="n">projectors</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
    <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">producers</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)),</span>
    <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">produce_age</span><span class="p">),</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">project</span><span class="p">(</span><span class="n">author</span><span class="p">))</span>
<span class="c1">#  {&#39;name&#39;: &#39;Some Author&#39;, &#39;age&#39;: 37}</span>
</code></pre></div>
<p>This composition generally happens at the place in your codebase where the domain model is actually being <em>used</em> (in a view, say). The projection will therefore contain precisely the keys needed by that view. This solves the problem of models becoming vast ever-growing flat namespaces containing all the functionality needed by all parts of your application.</p>
<p>Related objects can also be produced using the <a href="../reference/producers/#relationship"><code>producers.relationship</code></a> function, resulting in a nested projection:</p>
<div class="highlight"><pre><span></span><code><span class="n">project</span> <span class="o">=</span> <span class="n">projectors</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
    <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">producers</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)),</span>
    <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">produce_age</span><span class="p">),</span>
    <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span>
        <span class="s2">&quot;book_set&quot;</span><span class="p">,</span>
        <span class="n">producers</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span>
            <span class="s2">&quot;book_set&quot;</span><span class="p">,</span>
            <span class="n">projectors</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
                <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">,</span>
                    <span class="n">producers</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">projectors</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span>
                    <span class="s2">&quot;publication_date&quot;</span><span class="p">,</span>
                    <span class="n">producers</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;publication_date&quot;</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">project</span><span class="p">(</span><span class="n">author</span><span class="p">))</span>
<span class="c1">#  {</span>
<span class="c1">#      &#39;name&#39;: &#39;Some Author&#39;,</span>
<span class="c1">#      &#39;age&#39;: 37,</span>
<span class="c1">#      &#39;book_set&#39;: [</span>
<span class="c1">#          {&#39;title&#39;: &#39;Some Book&#39;, &#39;publication_date&#39;: 2019}</span>
<span class="c1">#      ]</span>
<span class="c1">#   }</span>
</code></pre></div>
<p>Note above that the second argument to <code>producers.relationship</code> is a projector function to project each related object.</p>
<h3 id="pairs">Pairs<a class="headerlink" href="#pairs" title="Permanent link">&para;</a></h3>
<p><code>prepare</code> and <code>produce</code> (and therefore also <code>project</code>) functions are intimately connected, with the <code>produce</code>/<code>project</code> functions usually depending on fields, annotations or relationships loaded by the <code>prepare</code> function. For this reason, <code>django-readers</code> expects these functions to live together in two-tuples: <code>(prepare, produce)</code> (a "producer pair") and <code>(prepare, project)</code> (a "projector pair"). Remember that the difference between <code>produce</code> and <code>project</code> is that the former returns a single value, whereas the latter returns a dictionary binding one or more names (keys) to one or more values.</p>
<p>In the example used above, the <code>produce_age</code> producer depends on the <code>birth_year</code> field:</p>
<div class="highlight"><pre><span></span><code><span class="n">age</span> <span class="o">=</span> <span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">include_fields</span><span class="p">(</span><span class="s2">&quot;birth_year&quot;</span><span class="p">),</span> <span class="n">produce_age</span><span class="p">)</span>
</code></pre></div>
<p><code>django-readers</code> includes <a href="../reference/pairs/">some useful functions that create pairs</a>. These attempt to generate the most efficient queries they can, which means loading only those database fields required to produce the value or values:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django_readers</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairs</span>

<span class="n">prepare</span><span class="p">,</span> <span class="n">produce</span> <span class="o">=</span> <span class="n">pairs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="n">queryset</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
<span class="c1">#  SELECT &quot;author&quot;.&quot;id&quot;, &quot;author&quot;.&quot;name&quot; FROM &quot;author&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">produce</span><span class="p">(</span><span class="n">queryset</span><span class="o">.</span><span class="n">first</span><span class="p">()))</span>
<span class="c1">#  &#39;Some Author&#39;</span>
</code></pre></div>
<p>When composing multiple pairs together, it is again necessary to wrap the producer to convert it to a projector, thus forming <code>(prepare, project)</code> pairs. This can be done with the <a href="../reference/pairs/#producer_to_projector"><code>pairs.producer_to_projector</code></a> function:</p>
<div class="highlight"><pre><span></span><code><span class="n">prepare</span><span class="p">,</span> <span class="n">project</span> <span class="o">=</span> <span class="n">pairs</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
    <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">pairs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)),</span>
    <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;birth_year&quot;</span><span class="p">,</span> <span class="n">pairs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;birth_year&quot;</span><span class="p">)),</span>
<span class="p">)</span>
</code></pre></div>
<p>Relationships can automatically be loaded and projected, too:</p>
<div class="highlight"><pre><span></span><code><span class="n">prepare</span><span class="p">,</span> <span class="n">project</span> <span class="o">=</span> <span class="n">pairs</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
    <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">pairs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)),</span>
    <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">age</span><span class="p">),</span>
    <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span>
        <span class="s2">&quot;book_set&quot;</span><span class="p">,</span>
        <span class="n">pairs</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span>
            <span class="s2">&quot;book_set&quot;</span><span class="p">,</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">pairs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)),</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">producer_to_projector</span><span class="p">(</span>
                    <span class="s2">&quot;publication_date&quot;</span><span class="p">,</span> <span class="n">pairs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;publication_date&quot;</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>Again, only the precise fields that are needed are loaded from the database. All relationship functions take an optional <code>to_attr</code> argument which is passed to the underlying <code>Prefetch</code> object.</p>
<p>Note that <code>django-readers</code> <em>always</em> uses <code>prefetch_related</code> to load relationships, even in circumstances where <code>select_related</code> would usually be used (i.e. <code>ForeignKey</code> and <code>OneToOneField</code>), resulting in one query per relationship. This approach allows the code to be "fractal": the tree of <code>(prepare, project)</code> pairs can be recursively applied to the tree of related querysets. It is possible to use <code>select_related</code> but this <a href="../cookbook/#use-select_related-instead-of-prefetch_related">must be done manually</a>.</p>
<h3 id="specs">Specs<a class="headerlink" href="#specs" title="Permanent link">&para;</a></h3>
<p>Manually assembling trees of pairs as seen above may seem long-winded. <a href="../reference/specs/">The <code>specs</code> module</a> provides a layer of syntactic sugar that makes it much easier. This layer is the real magic of <code>django-readers</code>: a straightforward way of specifying the shape of your data in order to efficiently select and project a complex tree of related objects.</p>
<p>The resulting nested dictionary structure may be returned from a view as a JSON response (assuming all your producers return JSON-serializable values), or included in a template context in place of a queryset or model instance.</p>
<p>A spec is a list. Under the hood, the <code>specs</code> module is a very lightweight wrapper on top of <code>pairs</code>. Each item in the list undergoes a simple transformation to replace it with a pair function. See <a href="../reference/specs/">the reference documentation for specs</a> for details.</p>
<p>The example from the last section may be written as the following spec:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django_readers</span><span class="w"> </span><span class="kn">import</span> <span class="n">specs</span>

<span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">age</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;book_set&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;title&quot;</span><span class="p">,</span>
            <span class="s2">&quot;publication_date&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">prepare</span><span class="p">,</span> <span class="n">project</span> <span class="o">=</span> <span class="n">specs</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

<span class="n">queryset</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">]</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The structure of this specification is heavily inspired by <a href="https://github.com/dabapps/django-rest-framework-serialization-spec/"><code>django-rest-framework-serialization-spec</code></a>, minus the concept of "plugins", which are replaced with directly including <code>(prepare, produce)</code> pairs in the spec. It should be trivial to convert or "adapt" a <code>serialization-spec</code> plugin into a suitable <code>django-readers</code> pair.</p>
</div>
<h2 id="where-should-this-code-go">Where should this code go?<a class="headerlink" href="#where-should-this-code-go" title="Permanent link">&para;</a></h2>
<p>We recommend that your custom functions go in a file called <code>readers.py</code> inside your Django apps. Specs should be declared at the point they are used, usually in your <code>views.py</code>.</p>
<h2 id="what-about-other-types-of-business-logic">What about other types of business logic?<a class="headerlink" href="#what-about-other-types-of-business-logic" title="Permanent link">&para;</a></h2>
<p>You'll notice that <code>django-readers</code> is focused on <em>reads</em>: business logic which selects some data from the database and/or transforms it in such a way that it can be displayed to a user. What about other common types of business logic that involve accepting input from users and processing it?</p>
<p><code>django-readers</code> doesn't provide any code to help with this, but we encourage you to follow the same function-oriented philosophy. Structure your codebase around functions which take model instances and encapsulate these sorts of write actions. You might choose to call them <code>action functions</code> and place them in a file called <code>actions.py</code>.</p>
<p>The other common task needed is data validation. We'd suggest Django forms and/or Django REST framework serializers are perfectly adequate here.</p>
<h2 id="is-django-readers-a-service-layer">Is <code>django-readers</code> a "service layer"?<a class="headerlink" href="#is-django-readers-a-service-layer" title="Permanent link">&para;</a></h2>
<p>Not really, although it does solve some of the same problems. It suggests alternative (and, we think, beneficial) ways to structure your business logic without attempting to hide or abstract away the underlying Django concepts, and so should be easily understandable by any experienced Django developer. You can easily "mix and match" <code>django-readers</code> concepts into an existing application.</p>
<p>If you are someone who feels more comfortable thinking in terms of established Design Patterns, you may consider the dictionaries returned from projector functions as simple <a href="https://martinfowler.com/eaaCatalog/dataTransferObject.html">Data Transfer Objects</a>, and the idea of dividing read and write logic into <code>readers</code> and <code>actions</code> as a version of <a href="https://martinfowler.com/bliki/CQRS.html">CQRS</a>.</p>
<h2 id="is-django-readers-a-serialization-or-data-conversion-library">Is <code>django-readers</code> a serialization or data conversion library?<a class="headerlink" href="#is-django-readers-a-serialization-or-data-conversion-library" title="Permanent link">&para;</a></h2>
<p>Not really, although again it does solve some of the same problems. <code>django-readers</code> is often compared to projects like <a href="https://www.attrs.org/"><code>attrs</code></a>/<a href="https://cattrs.readthedocs.io/"><code>cattrs</code></a> and <a href="https://pydantic-docs.helpmanual.io/"><code>pydantic</code></a>.</p>
<p>However, <code>django-readers</code> is focused on the <em>shape</em> of the data and how to extract it from the database (via the Django ORM) efficiently, rather than converting and validating the types. It eschews a class-oriented style in favour of plain, composable functions operating on plain data structures like dictionaries, and deliberately avoids static type annotations.</p>
<p>If your intention is to render your data to JSON, we recommend you use <code>django-readers</code> to project the model field values, and then lean on Django or Django REST framework's built-in rich encoders for converting types like <code>datetime</code> and <code>UUID</code> to JSON-friendly strings.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../cookbook/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Cookbook" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Cookbook
            </div>
          </div>
        </a>
      
      
        
        <a href="../reference/queryset-functions/" class="md-footer__link md-footer__link--next" aria-label="Next: Queryset functions" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Queryset functions
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://www.dabapps.com">A DabApps project</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>